<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Book Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>üìö Book Tracker</h1>
    <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏!</p>

    <h2>üîç –§–∏–ª—å—Ç—Ä—ã</h2>
    <form method="get" action="/">
        <label for="genre">–ñ–∞–Ω—Ä:</label>
        <input type="text" name="genre" value="{{ request.args.get('genre') }}">
        
        <label for="author">–ê–≤—Ç–æ—Ä:</label>
        <input type="text" name="author" value="{{ request.args.get('author') }}">
    
        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        {% if request.args %}
        <a href="/">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</a>
        {% endif %}
    </form>

    <!-- –ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="chart-container">
        <canvas id="booksChart"></canvas>
    </div>

    {% if books %}
        <ul>
        {% for book in books %}
            <li>
                "{{ book.title }}" ‚Äî {{ book.author }} ({{ book.genre }}), –ø—Ä–æ—á–∏—Ç–∞–Ω–æ: {{ book.date_read }}
                <br><br>
                <a href="{{ url_for('edit_book', id=book.id) }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a> |
                <a href="{{ url_for('delete_book', id=book.id) }}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏.</p>
    {% endif %}

    <p><a href="{{ url_for('add_book') }}">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É</a></p>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
    <script>
        const chartData = {
            labels: JSON.parse('{{ chart_labels | tojson | safe }}'),
            data: JSON.parse('{{ chart_data | tojson | safe }}')
        };
    </script>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('booksChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: '–ö–Ω–∏–≥ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ',
                    data: chartData.data,
                    backgroundColor: 'rgba(52, 152, 219, 0.7)',
                    borderColor: 'rgba(41, 128, 185, 1)',
                    borderWidth: 1,
                    barThickness: 20
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            precision: 0
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' –∫–Ω–∏–≥';
                            }
                        }
                    }
                },
                animation: {
                    duration: 1000
                }
            }
        });
    });
    </script>
</body>
</html>